<!-- templates/index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>智能试题生成器</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 20px auto; }
        .question { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        button { margin: 10px 0; padding: 8px 16px; }
    </style>
</head>
<body>
    <h1>上传 PDF/Word 生成试题</h1>
    <input type="file" id="fileInput" accept=".pdf,.docx">
    <button onclick="uploadFile()">生成试题</button>
    <div id="questions"></div>
    <button onclick="submitAnswers()" style="display:none" id="submitBtn">提交答题</button>

    <script>
        let questions = [];
        async function uploadFile() {
            const file = document.getElementById('fileInput').files[0];
            if (!file) return alert("请选择文件");
            const formData = new FormData();
            formData.append('file', file);
            const res = await fetch('/upload', { method: 'POST', body: formData });
            const data = await res.json();
            if (data.error) return alert(data.error);
            questions = data.questions;
            renderQuestions();
        }

        function renderQuestions() {
            let html = '';
            questions.forEach((q, i) => {
                html += `
                <div class="question">
                    <p><strong>${i+1}. ${q.question}</strong></p>
                    ${q.options.map((opt, j) => 
                        `<label><input type="radio" name="q${i}" value="${String.fromCharCode(65+j)}"> ${opt}</label><br>`
                    ).join('')}
                </div>`;
            });
            document.getElementById('questions').innerHTML = html;
            document.getElementById('submitBtn').style.display = 'inline';
        }

        async function submitAnswers() {
            const answers = [];
            questions.forEach((_, i) => {
                const selected = document.querySelector(`input[name="q${i}"]:checked`);
                answers.push(selected ? selected.value : "");
            });
            const res = await fetch('/submit', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({answers})
            });
            const result = await res.json();
            alert(`得分: ${result.score}`);
            console.log(result.results);
        }
    </script>
</body>
</html>